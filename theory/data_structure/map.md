# MAP - –ö–ê–†–¢–´

üìå **map** ‚Äî —ç—Ç–æ —Å—Å—ã–ª–æ—á–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä: –∫–ª—é—á ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ (—Ö–µ—à —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º)

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–∞—Ä—Ç–∞ –∏ –∫–∞–∫ –æ–Ω–∞ —É—Å—Ç—Ä–æ–µ–Ω–∞
## 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç
```go
// –û–±—ä—è–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ nil-map
// –¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
var m map[string]int

// –ß–µ—Ä–µ–∑ make
m := make(map[string]int)
m := make(map[string]int, 100) // —Å —Ç–æ—á–Ω–æ–π –µ–º–∫–æ—Å—Ç—å—é, 100 - hint –¥–ª—è —Ö–µ—à —Ç–∞–±–ª–∏—Ü—ã

// –ß–µ—Ä–µ–∑ –ª–∏—Ç–µ—Ä–∞–ª
m := map[string]int{
    "a": 1,
    "b": 2,
}
```
### –ö–∞–∫–∏–µ —Ç–∏–ø—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∫–ª—é—á? 
–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ - –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å comparable (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä ==)

| –¢–∏–ø                                      | –ú–æ–∂–Ω–æ –∫–∞–∫ –∫–ª—é—á? | –ü–æ—á–µ–º—É                                |
| ---------------------------------------- | --------------- | ------------------------------------- |
| `int`, `int8`, `int16`, `int32`, `int64` | ‚úÖ               | –ß–∏—Å–ª–∞ —Å—Ä–∞–≤–Ω–∏–º—ã                        |
| `uint`, `uintptr`                        | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–º—ã                              |
| `float32`, `float64`                     | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–º—ã (–∫—Ä–æ–º–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π `NaN`)   |
| `string`                                 | ‚úÖ               | –°—Ç—Ä–æ–∫–∏ —Å—Ä–∞–≤–Ω–∏–º—ã                       |
| `bool`                                   | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–º—ã                              |
| `complex64`, `complex128`                | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–º—ã                              |
| `pointer (*T)`                           | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É                |
| `chan`                                   | ‚úÖ               | –°—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É                |
| `array`                                  | ‚úÖ               | –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã comparable              |
| `struct`                                 | ‚úÖ               | –ï—Å–ª–∏ –í–°–ï –ø–æ–ª—è comparable              |
| `interface{}` / `any`                    | ‚úÖ               | –ï—Å–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ comparable |
| `slice`                                  | ‚ùå               | –ù–µ–ª—å–∑—è —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ `==`          |
| `map`                                    | ‚ùå               | –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ             |
| `function`                               | ‚ùå               | –ù–µ–ª—å–∑—è —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å                     |
| `struct` —Å–æ slice/map/function –≤–Ω—É—Ç—Ä–∏    | ‚ùå               | –ü–æ–ª–µ –Ω–µ—Å—Ä–∞–≤–Ω–∏–º–æ                       |
| `array` —Å–æ slice/map –≤–Ω—É—Ç—Ä–∏              | ‚ùå               | –≠–ª–µ–º–µ–Ω—Ç –Ω–µ—Å—Ä–∞–≤–Ω–∏–º                     |

## 3. –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
| –û–ø–µ—Ä–∞—Ü–∏—è               | –ü—Ä–∏–º–µ—Ä            | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç                        | –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –•—É–¥—à–∏–π —Å–ª—É—á–∞–π |
| ---------------------- | ----------------- | ------------------------------------- | ----------------- | ------------- |
| –ó–∞–ø–∏—Å—å                 | `m["a"] = 10`     | –î–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ | O(1)              | O(n)          |
| –ß—Ç–µ–Ω–∏–µ                 | `v := m["a"]`     | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É          | O(1)              | O(n)          |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è | `v, ok := m["a"]` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞               | O(1)              | O(n)          |
| –£–¥–∞–ª–µ–Ω–∏–µ               | `delete(m, "a")`  | –£–¥–∞–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –ø–æ –∫–ª—é—á—É              | O(1)              | O(n)          |
| –î–ª–∏–Ω–∞                  | `len(m)`          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤       | O(1)              | O(1)          |

### –ß—Ç–µ–Ω–∏–µ –∏–∑ map
```go
// –ï—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç -> –≤–µ—Ä–Ω–µ—Ç zero value —Ç–∏–ø–∞.
v := m["unknown"]

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
v, ok := m["a"]
if ok {
    fmt.Println("–ï—Å—Ç—å –∫–ª—é—á")
}


```

### –ò—Ç–µ—Ä–∞—Ü–∏—è
```go
// –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ö–æ–¥–∞ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω
for k, v := range m {
    fmt.Println(k, v)
}

```

### nil-map
`var m map[string]int`
| –û–ø–µ—Ä–∞—Ü–∏—è | –†–∞–±–æ—Ç–∞–µ—Ç? |
| -------- | --------- |
| –ß—Ç–µ–Ω–∏–µ   | ‚úÖ         |
| len      | ‚úÖ         |
| delete   | ‚úÖ         |
| –ó–∞–ø–∏—Å—å   | ‚ùå panic   |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ map
```go
// ‚ùå –ù–µ–ª—å–∑—è
m1 == m2

// –ú–æ–∂–Ω–æ
m == nil


```

### –û—á–∏—Å—Ç–∫–∞ map
```go
// –°–ø–æ—Å–æ–± 1
for k := range m {
    delete(m, k)
}

// –°–ø–æ—Å–æ–± 2
m = make(map[string]int)
```

## 4. Map –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
‚ö†Ô∏è **Map –ù–ï –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞.** –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö goroutine ‚Üí panic.
### üîπ –ö–∞–∫ —Ä–µ—à–∏—Ç—å
1. sync.Mutex
```go
var mu sync.Mutex
mu.Lock()
m["a"] = 1
mu.Unlock()
```
2. sync.Map
```go
var m sync.Map
m.Store("a", 1)
v, ok := m.Load("a")
```

## 5. –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç –ø–∞–º—è—Ç–∏
–ö–∞—Ä—Ç—ã –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º —Å—Ä–µ–∑—ã, –∏–∑-–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–µ—à–µ–π –∏ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π. –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏:
### –ó–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–≤–∞—Ç—å capacity
```go
m := make(map[string]int, 1000)
```
**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?**
* –ú–µ–Ω—å—à–µ —Ä–µ—Å–∞–π–∑–æ–≤
* –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π
* –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
* –ú–µ–Ω—å—à–µ –º—É—Å–æ—Ä–∞ –¥–ª—è GC

üìå –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.
### –í—ã–±–∏—Ä–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã –∫–ª—é—á–µ–π
```go
map[string]bool // –ø–ª–æ—Ö–æ
map[int]bool // –ª—É—á—à–µ
```
üî• –°—Ç—Ä–æ–∫–∏ ‚Äî —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ö–∞–∂–¥—ã–π string:
* 16 –±–∞–π—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞ 64-bit)
* –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

–ï—Å–ª–∏ –∫–ª—é—á–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è, –ª—É—á—à–µ:
* –∏–Ω—Ç–µ—Ä–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum (int) –∏–ª–∏ ID
### –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä struct-–∑–Ω–∞—á–µ–Ω–∏–π
–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç map —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞–∫–µ—Ç–µ. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–æ–µ:
```go
map[int]BigStruct // –ø–ª–æ—Ö–æ
map[int]*BigStruct // –ª—É—á—à–µ
```
üìå –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–º–µ—Ä –±–∞–∫–µ—Ç–∞.
### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å struct{} –≤–º–µ—Å—Ç–æ bool
–ï—Å–ª–∏ —Ç–µ–±–µ –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ (set):
```go
map[int]bool // –ø–ª–æ—Ö–æ
map[int]struct{} // –ª—É—á—à–µ
```
**–ü–æ—á–µ–º—É? - –≠–∫–æ–Ω–æ–º–∏—è –∑–∞–º–µ—Ç–Ω–∞ –ø—Ä–∏ –º–∏–ª–ª–∏–æ–Ω–∞—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.**
* struct{} –∑–∞–Ω–∏–º–∞–µ—Ç 0 –±–∞–π—Ç
* bool –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω–∏–º—É–º 1 –±–∞–π—Ç (–∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ)


### –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º struct
–ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä. –≠–∫–æ–Ω–æ–º–∏—è –∏–∑-–∑–∞ alignment.
```go
type Bad struct {
    A bool
    B int64
}
type Good struct {
    B int64
    A bool
}
```
### –£–¥–∞–ª—è—Ç—å map, –µ—Å–ª–∏ –æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
üìå GC –æ—Å–≤–æ–±–æ–¥–∏—Ç –ø–∞–º—è—Ç—å.
```go
m = nil
// –∏–ª–∏
m = make(map[int]int)
```
### –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ map
–í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π:
```go
for k := range m {
    delete(m, k)
}
```
–≠—Ç–æ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –Ω–æ–≤–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è –ø—Ä–∏ —á–∞—Å—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.
### –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ > 128 –±–∞–π—Ç ‚Äî –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å.

–ü–æ—á–µ–º—É?
* map –∫–æ–ø–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤–Ω—É—Ç—Ä—å –±–∞–∫–µ—Ç–∞
* –±–æ–ª—å—à–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –±–∞–∫–µ—Ç—ã
* –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ GC
### –ü–æ–Ω–∏–º–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
–í Go map —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:
* –º–∞—Å—Å–∏–≤–∞ –±–∞–∫–µ—Ç–æ–≤
* –∫–∞–∂–¥—ã–π –±–∞–∫–µ—Ç —Ö—Ä–∞–Ω–∏—Ç –¥–æ 8 –∫–ª—é—á–µ–π
* overflow-–±–∞–∫–µ—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
* –ß–µ–º –±–æ–ª—å—à–µ –∫–æ–ª–ª–∏–∑–∏–π ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏.
### –ò–∑–±–µ–≥–∞–π—Ç–µ —á–∞—Å—Ç—ã–µ —É–¥–∞–ª–µ–Ω–∏—è
–£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ –∫–∞—Ä—Ç—ã ‚Äî –∑–∞—Ç—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å –ø–æ–¥ –±–∞–∫–µ—Ç—ã –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è.
–í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–º–µ—á–∞–π—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–ª–∏ –æ—á–∏—â–∞–π—Ç–µ –∫–∞—Ä—Ç—É –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏.