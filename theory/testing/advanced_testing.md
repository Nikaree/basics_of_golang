# üìå 1. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ testify
**testify** ‚Äî —ç—Ç–æ —Å—Ç–æ—Ä–æ–Ω–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Go.

–û–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç:
* —É–¥–æ–±–Ω—ã–µ assert-—Ñ—É–Ω–∫—Ü–∏–∏
* require-—Ñ—É–Ω–∫—Ü–∏–∏ (—Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ç–µ—Å—Ç–∞)
* mocking (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–æ–≤)
* test suites (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è: **go get github.com/stretchr/testify**

## üîπ –ü–∞–∫–µ—Ç assert
üìå –ó–∞—á–µ–º –Ω—É–∂–µ–Ω
–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º testing –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–∏—Å–∞—Ç—å:
```go
if got != want {
t.Errorf("expected %v, got %v", want, got)
}
```
–° assert –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—â–µ –∏ –∫–æ—Ä–æ—á–µ.

üíª –ü—Ä–∏–º–µ—Ä
```go
import (
"testing"
"github.com/stretchr/testify/assert"
)

func TestSum(t *testing.T) {

	result := Sum(2, 3)

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
	assert.Equal(t, 5, result)

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ nil
	assert.NotNil(t, result)

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ
	assert.True(t, result == 5)
}
```
üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç assert
* –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç ‚Äî —Ç–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.
* –£–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ.
## üîπ –ü–∞–∫–µ—Ç require
üìå –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç assert
require ‚Äî —ç—Ç–æ "–∂—ë—Å—Ç–∫–∞—è" –≤–µ—Ä—Å–∏—è assert. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç: üëâ —Ç–µ—Å—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

üíª –ü—Ä–∏–º–µ—Ä
```go
import (
"testing"
"github.com/stretchr/testify/require"
)

func TestDivide(t *testing.T) {

	result, err := Divide(10, 2)

	// –ï—Å–ª–∏ err != nil, —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è
	require.NoError(t, err)

	require.Equal(t, 5, result)
}
```
üìå –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å require
* –ö–æ–≥–¥–∞ –±–µ–∑ —ç—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç –¥–∞–ª—å—à–µ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞
* –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—à–∏–±–æ–∫
* –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
## üîπ –ú–æ–∫–∏ –≤ testify (testify/mock)
–≠—Ç–æ —Å–∞–º–∞—è –º–æ—â–Ω–∞—è —á–∞—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

üìå –ó–∞—á–µ–º
–ü–æ–∑–≤–æ–ª—è–µ—Ç:
* –∑–∞–¥–∞–≤–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ –≤—ã–∑–æ–≤—ã
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤

üíª –ü—Ä–∏–º–µ—Ä
1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```go
type UserRepo interface {
GetUser(id int) string
}
```
2. –ú–æ–∫
```go

import "github.com/stretchr/testify/mock"

type MockRepo struct {
mock.Mock
}

func (m *MockRepo) GetUser(id int) string {
args := m.Called(id) // —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã–∑–æ–≤
return args.String(0)
}
```
3. –¢–µ—Å—Ç
```go
func TestService(t *testing.T) {

	mockRepo := new(MockRepo)

	// –ì–æ–≤–æ—Ä–∏–º: –æ–∂–∏–¥–∞–µ–º –≤—ã–∑–æ–≤ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º 1
	mockRepo.On("GetUser", 1).Return("Alice")

	service := Service{repo: mockRepo}

	name := service.GetUser(1)

	assert.Equal(t, "Alice", name)

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
	mockRepo.AssertExpectations(t)
}
```
üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
* On() ‚Äî –∑–∞–¥–∞—ë—Ç –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∑–æ–≤
* Return() ‚Äî –∑–∞–¥–∞—ë—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
* AssertExpectations() ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—ã–∑–æ–≤ —Ä–µ–∞–ª—å–Ω–æ –±—ã–ª
# üìå 2. –ó–∞–≥–ª—É—à–∫–∞ (stub) –¥–ª—è –ë–î
## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞–≥–ª—É—à–∫–∞ (stub) –¥–ª—è –ë–î
–ó–∞–≥–ª—É—à–∫–∞ ‚Äî —ç—Ç–æ **—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**, –∫–æ—Ç–æ—Ä–∞—è:
* –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ω–∞—Å—Ç–æ—è—â–µ–π –ë–î
* –Ω–µ –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–¢–æ –µ—Å—Ç—å –æ–Ω–∞ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ë–î.

## üîπ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ë–î
–ï—Å–ª–∏ –≤ —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â—É—é –ë–î:
‚ùå —Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏
‚ùå –Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏
‚ùå –Ω—É–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚ùå –≤–æ–∑–º–æ–∂–Ω—ã —Ñ–ª–µ–π–∫–∏
‚ùå —Å–ª–æ–∂–Ω–µ–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
–ü–æ—ç—Ç–æ–º—É –≤ unit-—Ç–µ—Å—Ç–∞—Ö –ë–î –ø–æ–¥–º–µ–Ω—è—é—Ç.

## üîπ –ö–∞–∫ —ç—Ç–æ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ Go
–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
1. **–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
```go
type UserRepository interface {
    GetByID(id int) (*User, error)
}
```
–¢–µ–ø–µ—Ä—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –Ω–µ –æ—Ç *sql.DB, –∞ –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

2. **–†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (production)**
```go
type PostgresRepo struct {
    db *sql.DB
}

func (r *PostgresRepo) GetByID(id int) (*User, error) {
row := r.db.QueryRow("SELECT id, name FROM users WHERE id=$1", id)

	var u User
	err := row.Scan(&u.ID, &u.Name)
	if err != nil {
		return nil, err
	}

	return &u, nil
}
```
3. **–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞**
```go
type StubRepo struct {
User *User
Err  error
}

func (s *StubRepo) GetByID(id int) (*User, error) {

	// –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
	return s.User, s.Err
}
```
4. **–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ —Ç–µ—Å—Ç–µ**
```go
func TestService_GetUser(t *testing.T) {

	// –°–æ–∑–¥–∞—ë–º –∑–∞–≥–ª—É—à–∫—É —Å –Ω—É–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
	stub := &StubRepo{
		User: &User{ID: 1, Name: "Alice"},
		Err:  nil,
	}

	service := Service{repo: stub}

	user, err := service.GetUser(1)

	if err != nil {
		t.Fatal("unexpected error")
	}

	if user.Name != "Alice" {
		t.Errorf("expected Alice, got %s", user.Name)
	}
}
```

## üîπ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–∞
* –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
* –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
* –∏–∑–æ–ª–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã


## üîπ –†–∞–∑–Ω–∏—Ü–∞: Stub vs Mock –¥–ª—è –ë–î
| Stub                            | Mock                       |
| ------------------------------- | -------------------------- |
| –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫ –µ–≥–æ –≤—ã–∑–≤–∞–ª–∏ |
| –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ | –ú–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã  |
| –ü—Ä–æ—Å—Ç–æ–π                         | –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π              |
